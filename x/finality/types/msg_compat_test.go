package types_test

import (
	"encoding/json"
	"testing"

	"github.com/babylonlabs-io/babylon/x/finality/types"
	"github.com/test-go/testify/require"
)

var (
	PR_COMMIT_LIST = `
		[{"start_height":8,"num_pub_rand":100,"commitment":"5dGe9BOsA5Ievrc5B0lGKW+MwYyVqaFl14mWirhG/x4="},{"start_height":5,"num_pub_rand":100,"commitment":"dQPFgp36QfOos49RgHH9fA2ScaHSQRnOAZvTh7IhDV8="},{"start_height":8,"num_pub_rand":100,"commitment":"dY8BQdoxGWJvfn+m3vi/LS++86xrRwVhJxfP9b0B/BQ="},{"start_height":9,"num_pub_rand":100,"commitment":"TCs9NLhU70OzmmzTUh6/wgxLGXbk5EKZ0TNOLoBI8I8="},{"start_height":4,"num_pub_rand":100,"commitment":"zcM/g+u2DzASHmv+WC4dhHfFOsrG0KFTsrtuCvkqXS0="},{"start_height":9,"num_pub_rand":100,"commitment":"WYNYu+otC82I3rxGcum0WCK0xyw44JgXN+h2rbamZ08="},{"start_height":6,"num_pub_rand":100,"commitment":"wzZemR/do6PdpTn3zHkS88rX8unFoIWsxfPpRq5yd38="},{"start_height":1,"num_pub_rand":100,"commitment":"u0l+VdbaCr68uj+sJOlyDZ1TeYakYVGVTvQCWy5cyfo="},{"num_pub_rand":100,"commitment":"v6BWw19L/2XoMk43eCwnRx2EtG+SCDy1Kak6YXGsOh0="},{"start_height":5,"num_pub_rand":100,"commitment":"jxAY+8dc5FLQ6Cfu3n3b31hn0JUEjCmbQFxZ3HSiBm8="}]
	`

	MSG_LIST = `[{"signer":"bbn160ncf20ssal4wncfxcnpmmga5vzgyh8pts6pxa","fp_btc_pk":"f4f41f9230d16ba19df03d06dfaccd2571f8937aad85ae0fc06f6eddc3549350","block_height":15,"pub_rand":"TxQJPmKrFJ+wjOEmPrDWqDWCiQzr+nQ23fdy7eOgIfY=","proof":{"total":100,"index":7,"leaf_hash":"sz+vAtFlWzqN26IDICq36JO4EccKYnVaYKDt3oGoFPY=","aunts":["N1MMCqYgo58Tn3tfkSLK4c0pCNh5Dp0Vrmat2OhCZFI=","gYTGG+l8qa/n/CdTKEWnya49VYfxshwfWHXYhJ+jlzI=","AdbhuRDig7Yghavdkz2xD1SXhKTLBTHj5dN8fqLTyHc=","rkAu46s7XN8n9x53AoAOT/kpDKcN3a7tqietajUArsc=","gXkX3iye+3LsY1ci4o0EETc4VF4kAXQwf4QR7p8TQVg=","S0BU7hoLmjcOgcywiengQPxz93DXBl/tkDF3Xy1S9/w=","zyVext/A5A5KM+GR17BhTZGLWq8XMx+cPs5P1SQQccY="]},"block_app_hash":"u0d5I1nl5DBqNv1TueIv/c+D3bK9ANd5zU8JMleY6tU=","finality_sig":"SU/ngTZ482H8QXrmx9YXvamK0G5lhEiaL9Z9O72dFlI="},{"signer":"bbn15cuqae6744q8r38dyxnl5nrhr6433lmufrrdur","fp_btc_pk":"8542b911a06f8906b723f5a83b2320097eb7084f52f2555fc9bbbbccc7550559","block_height":11,"pub_rand":"/5L6S+8qnV+0XyCObPxatYaunLGopnRqr1KMXPdHQ4s=","proof":{"total":100,"index":6,"leaf_hash":"vJ5bh9uy+J5cAfDyWBUO3aj/x3zMo437OJPEGI/dRso=","aunts":["vC8bZrIx9j8/Cm2bLPHwJe1Iu4J2aiHMMJfqJzobsPc=","q9nINJPiBUiT3MOvaOtNG5eJ8OWUqZmPU4zZJt3Ubsw=","Kt3TAUzOPA+CA0WH89AC8K/AA+2TTpKmjaFLRhlVxXY=","N6oO70RIANFkNjHn+ADM+/y6YeSugLU9eHhCwd6YLYw=","cY3XQhjYB69+Ocs+Y77cETaRxISjZdTta9vje/Egdj4=","TX2kas0cLVtJxXkfN6olyg9ST1anPqUXsPjx7/7+g+I=","nuDt+/QyIHtvJDJMyZdAa+zdKFETc1FHE+NLwul82+Q="]},"block_app_hash":"utycPH5zpIQ+ZIjBW28xTbcmLHuwJAV8YpN6G1qshe4=","finality_sig":"rBQeFW3lky32DT3Xn2h2NN0MX5EBbca8bQugOkyuaww="},{"signer":"bbn1s25v4uytdctsar70h77az0w93wgj6y6kzkm6an","fp_btc_pk":"e496da9d5301cb3ed1f4b7c767e8e1eed7b40a805c3c5ce1ab3a775ad6ed7746","block_height":10,"pub_rand":"gmZBmkg7GQW2FWAIw6D2/cTXG2gvN7m8znWB4vjuFhc=","proof":{"total":100,"index":2,"leaf_hash":"qU96AOalWOG0zHjkBkFvno9HlotlFn25TOVtXbCpvp0=","aunts":["OCGlty/5gd3zlirQd0oUvxv0d+1/SJxKPa8tBH2wCLo=","umJNY0knV63sp2mh2VPmxKMBGvAvOnts2HaxQ95WBCc=","TJVRNTER73uLiPQGbkLD5Jb5jpcsgQu71ejIXg3OKrk=","7DoRaGMfAGNRkqd7b2IeO15t8PomGy+6gdNpGvwy57E=","MOKPQvcT3/7e2BGlBnfluDqEmcQapowzzHFjNcdRST8=","M3UYYyxzuGG7Cf6kPa21t0XQfm9AfUSGnxYihFl63U0=","kxpBlSjVdJt0f49eCc92JHSJxV64pAqro4/mAikfNH8="]},"block_app_hash":"xVgvUnhiU2i9V5sYSFL/x8rh9UV0W2DsLFWHdYdOSm8=","finality_sig":"Pz+D+0E1BRaHo0NeK2SjJ3BHQwUqaV+lGgFuCgUJfyg="},{"signer":"bbn1qs2tjkfzt3fszgar2mn6k458kk98xrc8d94v2r","fp_btc_pk":"5266e58723dd831feaed36c2b913b76baeee652d0c3fb84ffced2fa9cb25e57f","block_height":10,"pub_rand":"1tLhG/q/O/LG0g/qAZOs6Modt1dwh2j/W4M6u+E2H+w=","proof":{"total":100,"index":1,"leaf_hash":"Gq50FBc2yfzukX+dAZqfn3AzKodSzBvbAjNRhSp1MRo=","aunts":["QSUQanb9O9/fd5um9LacfuUzjejc0agR6rgL3QJm8qY=","fs87qjw3EdS0oIcRFG2UvfNV1Y8ec/h1/RLyyPzJWh4=","DyJ1wWzurYXsS+ppmj0crGsYXUz3+MBlw6PJT2NxLxk=","bhLbYFLqw7/PN0lxfTheifCx+S6AzFxHneUaL9lDJ54=","sz91XTU4PQ9SqWE5OWPd9/FOlavAY5NYLmPR4A73qRk=","OlAC9sdVE0yfNQHwvpHYn1HrhzeOZVPqGw9JjaYOHYY=","W8zvaOA9AkZKeMM4gB7juvDA0McxGGgtl15nrqnjIR0="]},"block_app_hash":"UKmwgB+DK2pkxCs04uSqmf0f1NNoZMB3HzDghqJBZFM=","finality_sig":"Et2MTrNz6biSfu9skKgoPpPBjDTfWimsxOPgNyL6d80="},{"signer":"bbn1s6lqd79l035n9u607r9w332cyj3d4vuxwrcqpz","fp_btc_pk":"1f51f485b0547e54221b03052a70fdd4292d58d9bc7922f21970e83d9a5e869c","block_height":5,"pub_rand":"HffFpFKQFuIttoC24bKEK51ucRH6eSmGGzLhWAxNmW0=","proof":{"total":100,"index":1,"leaf_hash":"r/1OdevrukLftHhdyk4Qtn/WgzOcFfyjcLgoioEGKEU=","aunts":["mmSzrPjIDr56Wsc++X0yFHbM7Y+NVaw+N+wD4HDOfCk=","Prem3H82uRKvcKodWKOY3WNnxjGaVGYIDpQuvKckA3k=","wwr9jUrIXp3KZmvkcPKibwSxIV+cTLKwuCOlXByjTyE=","EwWOI5YOC/wttWwtssDkbWDk0PP8i2SWT58wdZVlddk=","4gpFnfK1TtmqF5ZzMO4xmKhtsnMF9/wHhRIEAfiHC00=","UExi4X7VUH4ZxGB0l7j3kFLbRN3IJ8XC2OwKq+DCt+4=","UToZe9T4Oih4hYEt+rx/A7Zwj3v4lYxrMftiIABLteA="]},"block_app_hash":"RuX3ZwBVseR48A4FKfBh4UJcssaK8XKo9xeketbvUBk=","finality_sig":"uyU15YNK2/C4LEwhd7LKQubLsrGnEWmgRpDCnZM/XPE="},{"signer":"bbn1ccyg70ygw5eg09uzrv55zx46a2pne5ggv66qaf","fp_btc_pk":"c65b72d24dc39e45e6a531d5bfba849bc8970635de20ae356174db597eed6952","block_height":17,"pub_rand":"nKXvL6kZmvhTrWHZWTHxk+rFGhZ5XEorutCjQwpuE2M=","proof":{"total":100,"index":8,"leaf_hash":"wAjHkQShS7rton5Ua7q12W4KI8EKEEGqQqbgGjjcCao=","aunts":["tLabPPrim4+Fnf/05UrLBVTFnQ7gkr4ksmi+7KS+YiA=","BooglVB7uUNPHfPsgeSvjwV65ThsHDcAemciuxZi8rE=","g5f05lIQO5cIKcswHcl+X6iQk2pqpZYwRs5jKNwqLHs=","tCpOfSuaVaqB61zUsI1F6dhD2t2keTT+ZeTfJqFob7U=","f4QHj+JKPEzew8nPtZaIOBF8xVwUcjPO1zcUa07KbUQ=","OsAoYgDR6u19bRlFCdrNdj2Egiu+sV9G+a9WL+JXXWU=","aV0Ga8MqFlaBLDVnBrE80plvtNWcEFw8l0O5VR7NkS8="]},"block_app_hash":"Xaepy1doOd4aE5qzcl3X3tl6bzFDFiZ4lAAGXblmJh8=","finality_sig":"Rda9W4tB67nyeGfl6lCZ7WIyKm6J8NfctmizBFR2RJE="},{"signer":"bbn15rl96ds76ysvx23hpd645lxzvpc8hfdvl7slza","fp_btc_pk":"8c86a5e98d8a827ede2f385575917c78f204d56752a8da5635367af0ff0142e5","block_height":8,"pub_rand":"QPHmhwPl1iirZYVeJTSKIR23j1KVXIyssz0C6x1PAwY=","proof":{"total":100,"index":2,"leaf_hash":"nv4lSbWSBOAaZQR5eonANksz43xTcTDEDMaSmQWnXSk=","aunts":["faDswILS8LdrbsLJ82JcxLpHOakyvPhPJx96DuWV2i8=","qC3zmxEZs6T5Z7L7ZdYhQY77+C7zbXUGrdb/9ymgCJw=","HqM439c8x26rr5ECe3epXu+kfdvIRvIMnOJOYU1vj5M=","+heaDTsHONRyEwo6sPo848bI8M6EdwybuY8CTMIteqQ=","sZfhvfB4BBMqZp56lqrEqeMz3FLl8BehbwlcL5/ZZAo=","AuRynZ3TEmJ1MnIoDvNRViQL0Wrnlhb1k3wvaB4oQ2g=","Vis+VWSD0aVkMAawzS3Xj5cxMAJWQwYRhZHXFFIA+Us="]},"block_app_hash":"x/sI8MiYaEj6vAajzg04IJP1cr7NlrwbpTmQon3a/yo=","finality_sig":"2zHaDimSfRKQODPUBAls7ddaIIjktJoDWp5+93YH+Nw="},{"signer":"bbn1f462z8rren6phxkh0hjchz95zvfqxm5r8nd9fe","fp_btc_pk":"607ef430bc765523662fd88111d5782bd6f80a2b83675aad0499fea18b852e82","block_height":3,"pub_rand":"+lnjbTtW2xyIoJLwO39DYhdgOyasAOzRcAia1uCBsjc=","proof":{"total":100,"index":2,"leaf_hash":"lsCnWnBgNKcUrADZB26FrayWsuYvuvuoVqEpcVYsFzI=","aunts":["KWuNDyOjoYsV80rR8fCpwf8l5pDUitH269auDcMSwDU=","bzI0begY+APmbKz4swpRMj0s7LbQoyH9MsKAZJ8L9do=","t9BnBlcAf4a4UIv1fqyz0VrCJhtYM9WQWLOsh67xAoc=","A/IxpIVW43J6WI0PxU3jiTkmtRH9OuL0M75gM9Vn26Q=","lQWQzt3sA+8LYtKGWwNr5Fs50OGW0RIuMGy+6s1Dqks=","lik6tPQ/jaB/eOd5gvzZwZbzfxOVqcqYgbIkcfV29S0=","UO3iX1WGPJm38AHUw/hmJwrQNkuKDOPB0QwOQ3y/e6I="]},"block_app_hash":"3+dxFTHbkzsDTRV0XG3HIJdYxIcaZ14nxDbKBZGicao=","finality_sig":"WIkuYe4kd7S1sbj9sfJYR+ednVAxdV4pxqvFaBE7kXY="},{"signer":"bbn1w4zz73rqurpau0rw0vf8g33cjx2l5janyg7zgx","fp_btc_pk":"36777c4b577010012c0ec7875489ef6d42b4c9d2ce8ea357cfa5adf7658e8904","block_height":2,"pub_rand":"he4MZ380Vnuw9Ik/ZnQCq0DurE79vt9Sg3VwtKuQeCU=","proof":{"total":100,"index":2,"leaf_hash":"JEn9GEjKPIsOj+cc/HzbGLxb2fY6xgYDsQsIhzIxhDU=","aunts":["UltkJytEHNfg1C6TWj3vBQ7gncfzdFZfSMxNcW7dwaQ=","L4jmjpwtEDdmye8mOukbZ3AcQv/cQpvTE5kdrLpakHw=","j3oJdkVCnF/Ptksbhn4zMD3aYioWvfIAEMEgRVl/WK4=","Dwy3PBS9hDQ/WlEDojMrmi34/80m9WZF8IANXDnXZoM=","BFCJJ3xMraNhf+vSbFuAl+gVeL8FmPRhAtrAkT/ndYE=","tM6T8tGP7GX8VA49kuve2ezQKvgAxeoA5MRyhm3tOV4=","0n/8KXPDK6VbwYxhaQmIDcwW4QYN5mTToxku59ifEX8="]},"block_app_hash":"o07f1qEuczIZeQ60tXh2orRkBX5Sz5N/rLDcBkCA7Cw=","finality_sig":"tU6/O4U9XotHyoYfT3xr0b7/CfSo/2T0fNG9fpv6vmk="},{"signer":"bbn1pqgyucd46prh8fa0kckm5ex2wngpf30fufue4f","fp_btc_pk":"ec84457a08069416dcba31d09a6781c847da57f5c60f928f5f3f3de9bc992c75","block_height":8,"pub_rand":"sSvVVAHWzjXlbZhDUw/1RaJcAzZhVcEQADDGDKBlNzQ=","proof":{"total":100,"index":3,"leaf_hash":"ZM5Ek1QkAvTDuDgbf/toJKe/5nEDKoniPRJQYPfL/pA=","aunts":["Um3erckW0d+S3RMJSrS2dKMatt2bjDo2I+S72MJGulc=","dxC5AvPbKXHUKkn3n267ORfasru88iBRgFtMkXOHZwY=","+Os/sRKCdemWkolUwO7dRMv0yjJbioiSIF5cfmB7LI0=","Q76yGDHuTDfJVZbzbBxxInYG7YFtPtfKFpyLtPHBsG4=","RVGGDZv1X2uNmarzMKRUjPTJwr0S3jDTfx3ywc2KlcY=","D2WwGhEJ/PRT1yPVwhF3s10wgcyrhfwdpYoi+XsxW44=","yzzgWDnR8U+xSKg8gCUfoLpZUoFYzZF9U2Gv3XTQMBg="]},"block_app_hash":"EmIif57hxIMFPkg4U/7XwOjsAm7kmWGRlDe2nay6TwM=","finality_sig":"55HPfa+TUI0ZxpXW5Ne1nbFwS9wS9c9xskovQrbdqTQ="}]
	`
)

func TestParseTestData(t *testing.T) {
	// Parse PR_COMMIT_LIST
	var prCommitList []*types.PubRandCommit
	err := json.Unmarshal([]byte(PR_COMMIT_LIST), &prCommitList)
	require.NoError(t, err)
	require.Len(t, prCommitList, 10)

	// Parse MSG_LIST
	var msgList []*types.MsgAddFinalitySig
	err = json.Unmarshal([]byte(MSG_LIST), &msgList)
	require.NoError(t, err)
	require.Len(t, msgList, 10)

	// Verify each message against its corresponding commit
	for i := 0; i < 10; i++ {
		err = types.VerifyFinalitySig(msgList[i], prCommitList[i])
		require.NoError(t, err)
	}
}
